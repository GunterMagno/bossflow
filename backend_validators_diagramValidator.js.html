<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>backend/validators/diagramValidator.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#AbilityNode">AbilityNode</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#ActionIcon">ActionIcon</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#ActionNode">ActionNode</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#ACTIVITY_STORAGE_PREFIX">ACTIVITY_STORAGE_PREFIX</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#ACTIVITY_TYPES">ACTIVITY_TYPES</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#allowedOrigins">allowedOrigins</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#api">api</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#App">App</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#auth">auth</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#AuthProvider">AuthProvider</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#authService">authService</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#baseURL">baseURL</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#clearActivities">clearActivities</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Community">Community</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#COMPATIBLE_VERSIONS">COMPATIBLE_VERSIONS</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ConfirmDialog">ConfirmDialog</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ConfirmModal">ConfirmModal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#connectDB">connectDB</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#CookieBanner">CookieBanner</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#CookiesPolicy">CookiesPolicy</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#createDiagram">createDiagram</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createTransporter">createTransporter</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#CURRENT_VERSION">CURRENT_VERSION</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#CustomEdge">CustomEdge</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Dashboard">Dashboard</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#DecisionIcon">DecisionIcon</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#DecisionNode">DecisionNode</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#DEFAULT_TEMPLATES">DEFAULT_TEMPLATES</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#deleteAccount">deleteAccount</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#deleteDiagram">deleteDiagram</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#deleteImage">deleteImage</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#deleteTemplate">deleteTemplate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#DiagramCard">DiagramCard</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#DiagramList">DiagramList</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Editor">Editor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#EditorSidebar">EditorSidebar</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#EffectIcon">EffectIcon</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#EffectNode">EffectNode</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#EndNode">EndNode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ExportHandler">ExportHandler</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ExportModal">ExportModal</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#exportUserData">exportUserData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#FlowMap">FlowMap</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Footer">Footer</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#formatRelativeDate">formatRelativeDate</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#getActivities">getActivities</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getCurrentUserId">getCurrentUserId</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#getDiagramById">getDiagramById</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#getDiagrams">getDiagrams</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#getFormattedActivities">getFormattedActivities</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#getProfile">getProfile</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#getStats">getStats</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getStorageKey">getStorageKey</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#getTemplates">getTemplates</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Handles">Handles</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#healthCheck">healthCheck</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Home">Home</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#http">http</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ImageNode">ImageNode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ImportJSON">ImportJSON</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isValidJSONFile">isValidJSONFile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isVersionCompatible">isVersionCompatible</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Layout">Layout</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Login">Login</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#login">login</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#logout">logout</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#MobileNodePanel">MobileNodePanel</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#mongoose">mongoose</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Navbar">Navbar</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#NewDiagramModal">NewDiagramModal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#NewTemplateModal">NewTemplateModal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#NodeDescriptionPopup">NodeDescriptionPopup</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#NodeEditModal">NodeEditModal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#NodeTitle">NodeTitle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#NotFound">NotFound</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#PhaseIcon">PhaseIcon</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#PhaseNode">PhaseNode</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#PositionNode">PositionNode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#PrivacyPolicy">PrivacyPolicy</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#PrivateRoute">PrivateRoute</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Profile">Profile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Register">Register</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#register">register</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#registerActivity">registerActivity</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#sendVerificationEmail">sendVerificationEmail</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#sendWelcomeEmail">sendWelcomeEmail</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Sidebar">Sidebar</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#StartEndIcon">StartEndIcon</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#StartNode">StartNode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#startServer">startServer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Status">Status</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#TemplateCard">TemplateCard</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#TemplateList">TemplateList</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Templates">Templates</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#TermsOfUse">TermsOfUse</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#TimerNode">TimerNode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Toast">Toast</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#ToastProvider">ToastProvider</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Toolbar">Toolbar</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#updateDiagram">updateDiagram</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#updateProfile">updateProfile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#uploadImage">uploadImage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#UploadImageModal">UploadImageModal</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#useAuth">useAuth</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#useExportDiagram">useExportDiagram</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#useHealthCheck">useHealthCheck</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#useRecentNodes">useRecentNodes</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#useToast">useToast</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validateDiagramStructure">validateDiagramStructure</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validateEdge">validateEdge</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validateEdges">validateEdges</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validateImageMetadata">validateImageMetadata</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validateImageUrl">validateImageUrl</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validateJSONStructure">validateJSONStructure</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validateNode">validateNode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validateNodes">validateNodes</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">backend/validators/diagramValidator.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// ============================================================
// File: diagramValidator.js
// Description: Validation functions for diagram data structure including nodes, edges, and image metadata.
// ============================================================

/**
 * Validates image metadata.
 * @param {Object} image - Image metadata to validate.
 * @param {string} image.filename - File name.
 * @param {string} image.url - Image URL.
 * @param {string} image.mimeType - MIME type (jpeg, png, gif, webp).
 * @param {number} image.size - Size in bytes (maximum 5MB).
 * @param {string} context - Context for error messages.
 * @returns {Object} Object with properties valid (boolean) and errors (array of strings).
 */
function validateImageMetadata(image, context) {
  const errors = [];
  const ALLOWED_MIME_TYPES = [
    "image/jpeg",
    "image/png",
    "image/gif",
    "image/webp",
  ];
  const MAX_SIZE = 5 * 1024 * 1024; // 5MB

  // Validate that the image is an object
  if (!image || typeof image !== "object") {
    return {
      valid: false,
      errors: [`${context}: must be a valid object`],
    };
  }

  // Validate filename (required)
  if (
    !image.filename ||
    typeof image.filename !== "string" ||
    image.filename.trim() === ""
  ) {
    errors.push(
      `${context}: the 'filename' field is required and must be a non-empty string`
    );
  }

  // Validate url (required)
  if (!image.url || typeof image.url !== "string" || image.url.trim() === "") {
    errors.push(
      `${context}: the 'url' field is required and must be a non-empty string`
    );
  }

  // Validate mimeType (required)
  if (!image.mimeType || typeof image.mimeType !== "string") {
    errors.push(
      `${context}: the 'mimeType' field is required and must be a string`
    );
  } else if (!ALLOWED_MIME_TYPES.includes(image.mimeType)) {
    errors.push(
      `${context}: 'mimeType' must be one of: ${ALLOWED_MIME_TYPES.join(", ")}`
    );
  }

  // Validate size (required)
  if (typeof image.size !== "number") {
    errors.push(
      `${context}: the 'size' field is required and must be a number`
    );
  } else if (image.size &lt; 0) {
    errors.push(`${context}: 'size' must be greater than or equal to 0`);
  } else if (image.size > MAX_SIZE) {
    errors.push(`${context}: 'size' cannot exceed ${MAX_SIZE} bytes (5MB)`);
  }

  // Validate createdAt (optional)
  if (
    image.createdAt !== undefined &amp;&amp;
    !(image.createdAt instanceof Date) &amp;&amp;
    isNaN(Date.parse(image.createdAt))
  ) {
    errors.push(`${context}: 'createdAt' must be a valid date`);
  }

  return {
    valid: errors.length === 0,
    errors,
  };
}

/**
 * Validates the structure of a diagram node.
 * @param {Object} node - Node to validate.
 * @param {string} node.id - Unique node ID.
 * @param {string} node.type - Node type.
 * @param {Object} node.position - Node position {x, y}.
 * @param {Object} node.data - Node data.
 * @param {number} index - Index of the node in the array.
 * @returns {Object} Object with properties valid (boolean) and errors (array of strings).
 */
function validateNode(node, index) {
  const errors = [];

  // Validate that the node exists
  if (!node || typeof node !== "object") {
    return {
      valid: false,
      errors: [`Node at position ${index}: must be a valid object`],
    };
  }

  // Validate 'id' field (required)
  if (!node.id || typeof node.id !== "string" || node.id.trim() === "") {
    errors.push(
      `Node at position ${index}: the 'id' field is required and must be a non-empty string`
    );
  }

  // Validate 'type' field (required)
  if (!node.type || typeof node.type !== "string" || node.type.trim() === "") {
    errors.push(
      `Node at position ${index}: the 'type' field is required and must be a non-empty string`
    );
  }

  // Validate 'position' field (required)
  if (!node.position || typeof node.position !== "object") {
    errors.push(
      `Node at position ${index}: the 'position' field is required and must be an object`
    );
  } else {
    // Validate position.x
      if (typeof node.position.x !== "number") {
      errors.push(`Node at position ${index}: 'position.x' must be a number`);
    }

    // Validate position.y
    if (typeof node.position.y !== "number") {
      errors.push(`Node at position ${index}: 'position.y' must be a number`);
    }
  }

  // Validate 'data' field (required, can be empty object)
  if (node.data === undefined || node.data === null) {
    errors.push(
      `Node at position ${index}: the 'data' field is required (may be an empty object {})`
    );
  } else if (typeof node.data !== "object") {
    errors.push(
      `Node at position ${index}: the 'data' field must be an object`
    );
  }

  // Validate 'image' field
  if (node.image !== undefined &amp;&amp; node.image !== null) {
    const imageValidation = validateImageMetadata(
      node.image,
      `Node at position ${index}, 'image' field`
    );
    if (!imageValidation.valid) {
      errors.push(...imageValidation.errors);
    }
  }

  return {
    valid: errors.length === 0,
    errors,
  };
}

/**
 * Validates the structure of an edge (connection between nodes).
 * @param {Object} edge - Edge to validate.
 * @param {Array} nodes - Array of nodes to validate references.
 * @returns {Object} { valid: boolean, errors: string[] }
 */
function validateEdge(edge, index, nodes = []) {
  const errors = [];

  // Validate that the edge exists
  if (!edge || typeof edge !== "object") {
    return {
      valid: false,
      errors: [`Edge at position ${index}: must be a valid object`],
    };
  }

  // Validate 'id' field (required)
  if (!edge.id || typeof edge.id !== "string" || edge.id.trim() === "") {
    errors.push(
      `Edge at position ${index}: the 'id' field is required and must be a non-empty string`
    );
  }

  // Validate 'source' field (required)
  if (
    !edge.source ||
    typeof edge.source !== "string" ||
    edge.source.trim() === ""
  ) {
    errors.push(
      `Edge at position ${index}: the 'source' field is required and must be a non-empty string`
    );
  } else if (nodes.length > 0) {
    // Validate that the source node exists
    const sourceExists = nodes.some((node) => node.id === edge.source);
    if (!sourceExists) {
      errors.push(
        `Edge at position ${index}: source node with id '${edge.source}' does not exist`
      );
    }
  }

  // Validate 'target' field (required)
  if (
    !edge.target ||
    typeof edge.target !== "string" ||
    edge.target.trim() === ""
  ) {
    errors.push(
      `Edge at position ${index}: the 'target' field is required and must be a non-empty string`
    );
  } else if (nodes.length > 0) {
    // Validate that the target node exists
    const targetExists = nodes.some((node) => node.id === edge.target);
    if (!targetExists) {
      errors.push(
        `Edge at position ${index}: target node with id '${edge.target}' does not exist`
      );
    }
  }

  // Validate that source and target are different
  if (edge.source &amp;&amp; edge.target &amp;&amp; edge.source === edge.target) {
    errors.push(
      `Edge at position ${index}: 'source' and 'target' cannot be the same node`
    );
  }

  return {
    valid: errors.length === 0,
    errors,
  };
}

/**
 * Validates the full array of nodes.
 * @param {Array} nodes - Array of nodes to validate.
 * @returns {Object} Object with properties valid (boolean) and errors (array of strings).
 */
function validateNodes(nodes) {
  if (!Array.isArray(nodes)) {
    return {
      valid: false,
      errors: ['The "nodes" field must be an array'],
    };
  }

  // Validate unique IDs
  const nodeIds = nodes.map((n) => n?.id).filter(Boolean);
  const duplicateIds = nodeIds.filter(
    (id, index) => nodeIds.indexOf(id) !== index
  );

  if (duplicateIds.length > 0) {
    return {
      valid: false,
      errors: [
        `Duplicate node IDs: ${[...new Set(duplicateIds)].join(", ")}`,
      ],
    };
  }

  // Validate each node individually
  const allErrors = [];
  nodes.forEach((node, index) => {
    const validation = validateNode(node, index);
    if (!validation.valid) {
      allErrors.push(...validation.errors);
    }
  });

  return {
    valid: allErrors.length === 0,
    errors: allErrors,
  };
}

/**
 * Validates the full array of connections (edges).
 * @param {Array} edges - Array of edges to validate.
 * @param {Array} nodes - Array of nodes to validate references.
 * @returns {Object} Object with properties valid (boolean) and errors (array of strings).
 */
function validateEdges(edges, nodes = []) {
  if (!Array.isArray(edges)) {
    return {
      valid: false,
      errors: ['The "edges" field must be an array'],
    };
  }

  // Validate unique IDs
  const edgeIds = edges.map((e) => e?.id).filter(Boolean);
  const duplicateIds = edgeIds.filter(
    (id, index) => edgeIds.indexOf(id) !== index
  );

  if (duplicateIds.length > 0) {
    return {
      valid: false,
      errors: [
        `Duplicate edge IDs: ${[...new Set(duplicateIds)].join(", ")}`,
      ],
    };
  }

  // Validate each edge individually
  const allErrors = [];
  edges.forEach((edge, index) => {
    const validation = validateEdge(edge, index, nodes);
    if (!validation.valid) {
      allErrors.push(...validation.errors);
    }
  });

  return {
    valid: allErrors.length === 0,
    errors: allErrors,
  };
}

/**
 * Validates the complete diagram structure (nodes, edges and images).
 * @param {Object} diagramData - Diagram data.
 * @param {Array} diagramData.nodes - Array of nodes (optional, default []).
 * @param {Array} diagramData.edges - Array of edges (optional, default []).
 * @param {Array} diagramData.images - Array of images (optional, default []).
 * @returns {Object} Object with properties valid (boolean) and errors (array of strings).
 */
function validateDiagramStructure(diagramData) {
  const { nodes = [], edges = [], images = [] } = diagramData;
  const allErrors = [];
  const MAX_IMAGES = 10;

  // Validate diagram images
  if (!Array.isArray(images)) {
    allErrors.push('The "images" field must be an array');
  } else {
    if (images.length > MAX_IMAGES) {
      allErrors.push(
        `A diagram cannot have more than ${MAX_IMAGES} images`
      );
    }

    images.forEach((image, index) => {
      const imageValidation = validateImageMetadata(
        image,
        `Diagram image at position ${index}`
      );
      if (!imageValidation.valid) {
        allErrors.push(...imageValidation.errors);
      }
    });
  }

  // Validate nodes
  const nodesValidation = validateNodes(nodes);
  if (!nodesValidation.valid) {
    allErrors.push(...nodesValidation.errors);
  }

  // Validate edges (only if nodes are valid to avoid cascading errors)
  if (nodesValidation.valid) {
    const edgesValidation = validateEdges(edges, nodes);
    if (!edgesValidation.valid) {
      allErrors.push(...edgesValidation.errors);
    }
  } else {
    // If nodes are not valid, validate edges without references
    const edgesValidation = validateEdges(edges, []);
    if (!edgesValidation.valid) {
      allErrors.push(...edgesValidation.errors);
    }
  }

  return {
    valid: allErrors.length === 0,
    errors: allErrors,
  };
}

module.exports = {
  validateImageMetadata,
  validateNode,
  validateEdge,
  validateNodes,
  validateEdges,
  validateDiagramStructure,
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Thu Feb 12 2026 08:00:56 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
